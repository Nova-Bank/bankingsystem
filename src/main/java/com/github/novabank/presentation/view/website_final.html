<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Bank Login</title>

  <style>
    /* =========================
       GLOBAL RESET + BASE STYLE
       ========================= */
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      min-height: 100vh;
      padding: 20px;
    }

    /* =========================
       LOGIN / REGISTER / FORGOT
       ========================= */
    .login-box {
      background: white;
      width: 450px;
      margin: 80px auto;
      padding: 50px;
      border-radius: 20px;
      text-align: center;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideIn 0.5s ease-out;
    }

    @keyframes slideIn {
      from { opacity: 0; transform: translateY(-30px); }
      to { opacity: 1; transform: translateY(0); }
    }

    h1 {
      color: #2d3748;
      margin-bottom: 15px;
      font-size: 32px;
      font-weight: 700;
      letter-spacing: 1px;
    }

    .user-icon {
      width: 100px;
      height: 100px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 50%;
      margin: 20px auto 30px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 50px;
      color: white;
      box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
    }

    .input-container {
      display: flex;
      margin-bottom: 25px;
      border: 2px solid #e2e8f0;
      border-radius: 12px;
      overflow: hidden;
      transition: all 0.3s ease;
      background: #f7fafc;
    }

    .input-container:focus-within {
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
      background: white;
    }

    .icon-box {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      padding: 15px;
      width: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 24px;
    }

    input {
      flex: 1;
      padding: 15px 20px;
      border: none;
      font-size: 16px;
      outline: none;
      background: transparent;
      color: #2d3748;
    }

    input::placeholder { color: #a0aec0; }

    .options {
      display: flex;
      justify-content: space-between;
      margin-bottom: 25px;
      font-size: 14px;
      color: #4a5568;
    }

    .link {
      color: #667eea;
      cursor: pointer;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.3s ease;
    }

    .link:hover {
      color: #764ba2;
      text-decoration: underline;
    }

    button {
      width: 100%;
      padding: 18px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 18px;
      cursor: pointer;
      font-weight: 700;
      letter-spacing: 1px;
      transition: all 0.3s ease;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
    }

    button:active { transform: translateY(0); }

    .error {
      color: #e53e3e;
      margin-top: 15px;
      display: none;
      font-weight: 600;
    }

    /* =========================
       MAIN APP PAGES (DASHBOARD)
       ========================= */
    .home-box,
    .application-box,
    .account-history-box,
    .credit-score-box {
      background: white;
      width: 1000px;
      margin: 50px auto;
      padding: 50px;
      border-radius: 20px;
      display: none;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      animation: slideIn 0.5s ease-out;
    }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 3px solid #e2e8f0;
      padding-bottom: 25px;
      margin-bottom: 40px;
    }

    .header h1 {
      font-size: 36px;
      color: #2d3748;
      font-weight: 700;
    }

    .header-buttons {
      display: flex;
      gap: 15px;
    }

    .header-buttons button {
      padding: 12px 24px;
      font-size: 15px;
      border-radius: 10px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      width: auto;
    }

    .logout {
      background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
      padding: 12px 30px;
    }

    .logout:hover {
      background: linear-gradient(135deg, #e53e3e 0%, #c53030 100%);
    }

    .account-card {
      color: white;
      padding: 35px;
      margin-bottom: 25px;
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      transition: all 0.3s ease;
    }

    .account-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
    }

    .account-card > div:first-child {
      font-size: 12px;
      opacity: 0.9;
      letter-spacing: 2px;
      margin-bottom: 10px;
    }

    .account-card h2 {
      font-size: 28px;
      margin-bottom: 20px;
      font-weight: 600;
    }

    .checking { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .savings { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
    .credit  { background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); }

    .balance {
      font-size: 48px;
      font-weight: 700;
      margin: 20px 0;
    }

    .account-actions {
      display: flex;
      gap: 12px;
      margin-top: 25px;
    }

    .action-btn {
      flex: 1;
      padding: 14px;
      background: rgba(255, 255, 255, 0.25);
      border: 2px solid rgba(255, 255, 255, 0.4);
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      transition: all 0.3s ease;
      width: auto;
    }

    .action-btn:hover {
      background: rgba(255, 255, 255, 0.35);
      border-color: rgba(255, 255, 255, 0.6);
    }

    /* =========================
       MODALS (TRANSFER / PAYMENT)
       ========================= */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0, 0, 0, 0.6);
      backdrop-filter: blur(5px);
      z-index: 1000;
    }

    .modal.show {
      display: flex;
      align-items: center;
      justify-content: center;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    .modal-content {
      background: white;
      padding: 40px;
      border-radius: 20px;
      width: 450px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.4);
      animation: slideIn 0.3s ease-out;
    }

    .modal-content h2 {
      color: #2d3748;
      margin-bottom: 30px;
      font-size: 28px;
      font-weight: 700;
    }

    .form-group { margin-bottom: 25px; }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #4a5568;
      font-size: 14px;
    }

    .form-group select,
    .form-group input {
      width: 100%;
      padding: 14px;
      border: 2px solid #e2e8f0;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s ease;
      background: #f7fafc;
    }

    .form-group select:focus,
    .form-group input:focus {
      border-color: #667eea;
      background: white;
      outline: none;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }

    /* =========================
       ACCOUNT HISTORY CARDS
       ========================= */
    .detail-card {
      background: linear-gradient(135deg, #f7fafc 0%, #edf2f7 100%);
      padding: 30px;
      border-radius: 15px;
      margin-bottom: 25px;
      border-left: 5px solid #667eea;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
    }

    .detail-card h3 {
      color: #667eea;
      margin-bottom: 20px;
      font-size: 20px;
      font-weight: 700;
      margin-top: 20px;
    }

    .detail-row {
      display: flex;
      justify-content: space-between;
      padding: 15px 0;
      border-bottom: 1px solid #e2e8f0;
      color: #4a5568;
    }

    .detail-row:last-child { border-bottom: none; }

    .detail-row span:first-child { font-weight: 600; }
    .detail-row span:last-child { color: #2d3748; }

    /* =========================
       CREDIT SCORE DISPLAY
       ========================= */
    .score-display {
      width: 280px;
      height: 280px;
      margin: 0 auto 40px;
      border-radius: 50%;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      box-shadow: 0 20px 60px rgba(102, 126, 234, 0.4);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .score-number {
      font-size: 90px;
      font-weight: 700;
      line-height: 1;
    }

    .score-display > div:last-child {
      font-size: 16px;
      letter-spacing: 2px;
      margin-top: 10px;
      opacity: 0.9;
    }
  </style>
</head>

<body>

  <!-- =========================
       LOGIN PAGE (LoginDTO)
       ========================= -->
  <div id="loginPage" class="login-box">
    <h1>MEMBER LOGIN</h1>
    <div class="user-icon">ðŸ‘¤</div>

    <div class="input-container">
      <div class="icon-box">ðŸ‘¤</div>
      <input type="text" id="username" placeholder="Username">
    </div>

    <div class="input-container">
      <div class="icon-box">ðŸ”’</div>
      <input type="password" id="password" placeholder="Password">
    </div>

    <div class="options">
      <label><input type="checkbox"> Remember me</label>
      <a href="#" class="link" id="forgotLink">Forgot password?</a>
    </div>

    <button id="loginButton">LOGIN</button>
    <p class="error" id="error">Invalid username or password</p>

    <p style="margin-top: 20px; font-size: 14px;">
      Don't have an account?
      <a href="#" class="link" id="registerLink">Register here</a>
    </p>
  </div>

  <!-- =========================
       REGISTRATION PAGE (RegisterDTO)
       ========================= -->
  <div id="registerPage" class="login-box" style="display: none;">
    <h1>CREATE ACCOUNT</h1>
    <div class="user-icon">ðŸ‘¤</div>

    <div class="input-container">
      <div class="icon-box">ðŸ‘¤</div>
      <input type="text" id="regUsername" placeholder="Username">
    </div>

    <div class="input-container">
      <div class="icon-box">ðŸ“§</div>
      <input type="email" id="regEmail" placeholder="Email">
    </div>

    <div class="input-container">
      <div class="icon-box">ðŸŽ‚</div>
      <input type="number" id="regAge" placeholder="Age" min="1" max="120">
    </div>

    <div class="input-container">
      <div class="icon-box">ðŸ”’</div>
      <input type="password" id="regPassword" placeholder="Password">
    </div>

    <div class="input-container">
      <div class="icon-box">ðŸ”’</div>
      <input type="password" id="regConfirmPassword" placeholder="Confirm Password">
    </div>

    <button id="registerButton">CREATE ACCOUNT</button>
    <p class="error" id="regError"></p>

    <p style="margin-top: 20px; font-size: 14px;">
      Already have an account?
      <a href="#" class="link" id="loginLink">Login here</a>
    </p>
  </div>

  <!-- =========================
       HOME / DASHBOARD
       ========================= -->
  <div id="homePage" class="home-box">
    <div class="header">
      <h1>My Accounts</h1>
      <div class="header-buttons">
        <button id="viewCreditScoreBtn" style="background: #667eea;">Credit Score</button>
        <button id="viewHistoryBtn" style="background: #5a67d8;">Account History</button>
        <button id="applyCreditBtn" style="background: #5a67d8;">Apply for Credit</button>
        <button class="logout" id="logoutButton">Logout</button>
      </div>
    </div>

    <p style="font-size: 18px; margin-bottom: 30px;">
      Welcome back, <strong id="displayUsername"></strong>!
    </p>

    <div class="account-card checking">
      <div>CHECKING ACCOUNT</div>
      <h2>Primary Checking</h2>
      <div class="balance" id="checkingBalance">$0.00</div>
      <div class="account-actions">
        <button class="action-btn" id="transferChecking">Transfer</button>
      </div>
    </div>

    <div class="account-card savings">
      <div>SAVINGS ACCOUNT</div>
      <h2>Savings</h2>
      <div class="balance" id="savingsBalance">$0.00</div>
      <div class="account-actions">
        <button class="action-btn" id="transferSavings">Transfer</button>
      </div>
    </div>

    <div class="account-card credit" id="creditCard" style="display: none;">
      <div>CREDIT CARD</div>
      <h2>Credit</h2>
      <div class="balance" id="creditBalance">$0.00</div>
      <div class="account-actions">
        <button class="action-btn" id="payCardBtn">Pay Card</button>
      </div>
    </div>
  </div>

  <!-- =========================
       CREDIT APPLICATION PAGE
       ========================= -->
  <div id="applicationPage" class="application-box">
    <h1 style="text-align: center; margin-bottom: 30px;">Credit Card Application</h1>

    <div style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white; padding: 25px; border-radius: 10px; text-align: center; margin-bottom: 30px;">
      <h2>Premium Credit Card</h2>
      <p>Credit Limit: $5,000</p>
    </div>

    <div style="display: flex; gap: 15px;">
      <button id="backToHome" style="flex: 1; background: #e2e8f0; color: #333;">Back</button>
      <button id="approveApplication" style="flex: 2; background: #48bb78;">Approve Card</button>
    </div>
  </div>

  <!-- =========================
       ACCOUNT HISTORY PAGE
       ========================= -->
  <div id="accountHistoryPage" class="account-history-box">
    <div class="header">
      <h1>Account History</h1>
      <button class="logout" id="backFromHistory">Back</button>
    </div>

    <div class="detail-card">
      <div class="detail-row">
        <span>Account Type:</span>
        <span id="accountType"></span>
      </div>

      <div class="detail-row">
        <span>Age:</span>
        <span id="accountAge"></span>
      </div>

      <h3>Personal Information</h3>

      <div class="detail-row">
        <span>Account Holder:</span>
        <span id="historyUsername"></span>
      </div>

      <div class="detail-row">
        <span>Customer ID:</span>
        <span id="customerId"></span>
      </div>
    </div>
  </div>

  <!-- =========================
       CREDIT SCORE PAGE
       ========================= -->
  <div id="creditScorePage" class="credit-score-box">
    <h1 style="text-align: center; margin-bottom: 30px;">Your Credit Score</h1>

    <div class="score-display">
      <div class="score-number" id="creditScoreNumber">750</div>
      <div>CREDIT SCORE</div>
    </div>

    <div style="text-align: center; margin-top: 30px;">
      <button class="logout" id="backFromCreditScore" style="width: 200px;">Back to Accounts</button>
    </div>
  </div>

  <!-- =========================
       TRANSFER MODAL
       ========================= -->
  <div class="modal" id="transferModal">
    <div class="modal-content">
      <h2>Transfer Money</h2>

      <div class="form-group">
        <label>From:</label>
        <select id="fromAccount">
          <option value="checking">Checking</option>
          <option value="savings">Savings</option>
        </select>
      </div>

      <div class="form-group">
        <label>To:</label>
        <select id="toAccount">
          <option value="checking">Checking</option>
          <option value="savings">Savings</option>
        </select>
      </div>

      <div class="form-group">
        <label>Amount:</label>
        <input type="number" id="transferAmount" placeholder="0.00" min="0.01" step="0.01">
      </div>

      <div style="display: flex; gap: 10px;">
        <button id="cancelTransfer" style="background: #e2e8f0; color: #333;">Cancel</button>
        <button id="confirmTransfer">Transfer</button>
      </div>
    </div>
  </div>

  <!-- =========================
       FORGOT PASSWORD PAGE
       ========================= -->
  <div id="forgotPage" class="login-box" style="display: none;">
    <h1>RESET PASSWORD</h1>
    <div class="user-icon">ðŸ”‘</div>

    <div class="input-container">
      <div class="icon-box">ðŸ‘¤</div>
      <input type="text" id="forgotUsername" placeholder="Username">
    </div>

    <div class="input-container">
      <div class="icon-box">ðŸ”’</div>
      <input type="password" id="newPassword" placeholder="New Password">
    </div>

    <div class="input-container">
      <div class="icon-box">ðŸ”’</div>
      <input type="password" id="confirmNewPassword" placeholder="Confirm New Password">
    </div>

    <button id="resetPasswordBtn">RESET PASSWORD</button>
    <p class="error" id="forgotError"></p>

    <p style="margin-top: 20px; font-size: 14px;">
      Remembered your password?
      <a href="#" class="link" id="backToLoginFromForgot">Login here</a>
    </p>
  </div>

  <!-- =========================
       PAY CREDIT CARD MODAL
       ========================= -->
  <div class="modal" id="payCardModal">
    <div class="modal-content">
      <h2>Pay Credit Card</h2>

      <div class="form-group">
        <label>From:</label>
        <select id="payFromAccount">
          <option value="checking">Checking</option>
          <option value="savings">Savings</option>
        </select>
      </div>

      <div class="form-group">
        <label>Amount:</label>
        <input type="number" id="paymentAmount" placeholder="0.00" min="0.01" step="0.01">
      </div>

      <div style="display: flex; gap: 10px;">
        <button id="cancelPayment" style="background: #e2e8f0; color: #333;">Cancel</button>
        <button id="confirmPayment">Pay Now</button>
      </div>
    </div>
  </div>

  <!-- =========================
       JAVASCRIPT LOGIC
       ========================= -->
  <script>
    // --- Demo data ---
    var accounts = {};
    var users = { demo: 'password123' };

    var userAccounts = {
      demo: {
        checking: 5247.89,
        savings: 18532.45,
        credit: -1234.56,
        hasCredit: true,
        createdDate: 'Jan 15 2024',
        customerId: 'CUS-001',
        creditScore: 750,
        age: 25,
        accountType: "Adult"
      }
    };

    window.onload = function () {
      var loggedIn = localStorage.getItem('loggedIn');
      var currentUser = localStorage.getItem('username');

      if (loggedIn === 'true' && currentUser) {
        document.getElementById('loginPage').style.display = 'none';
        document.getElementById('homePage').style.display = 'block';
        document.getElementById('displayUsername').innerHTML = currentUser;

        accounts = userAccounts[currentUser] || {
          checking: 0,
          savings: 0,
          credit: 0,
          hasCredit: false,
          createdDate: new Date().toLocaleDateString(),
          customerId: 'CUS-' + Date.now(),
          creditScore: 650,
          age: 18,
          accountType: "Adult"
        };

        if (accounts.hasCredit) {
          document.getElementById('creditCard').style.display = 'block';
          document.getElementById('applyCreditBtn').style.display = 'none';
          document.getElementById('viewCreditScoreBtn').style.display = 'block';
        } else {
          document.getElementById('viewCreditScoreBtn').style.display = 'none';
        }

        updateBalances();
      }

      // Navigation
      document.getElementById('registerLink').onclick = function (e) {
        e.preventDefault();
        showOnly('registerPage');
      };

      document.getElementById('loginLink').onclick = function (e) {
        e.preventDefault();
        showOnly('loginPage');
      };

      document.getElementById('forgotLink').onclick = function (e) {
        e.preventDefault();
        showOnly('forgotPage');
      };

      document.getElementById('backToLoginFromForgot').onclick = function (e) {
        e.preventDefault();
        showOnly('loginPage');
      };

      // Actions
      document.getElementById('loginButton').onclick = login;
      document.getElementById('registerButton').onclick = register;
      document.getElementById('logoutButton').onclick = logout;

      document.getElementById('applyCreditBtn').onclick = applyForCredit;
      document.getElementById('viewHistoryBtn').onclick = viewHistory;
      document.getElementById('viewCreditScoreBtn').onclick = viewCreditScore;

      document.getElementById('backFromHistory').onclick = function () { showOnly('homePage'); };
      document.getElementById('backFromCreditScore').onclick = function () { showOnly('homePage'); };
      document.getElementById('backToHome').onclick = function () { showOnly('homePage'); };

      document.getElementById('approveApplication').onclick = approveCredit;

      document.getElementById('transferChecking').onclick = function () { openTransfer('checking'); };
      document.getElementById('transferSavings').onclick = function () { openTransfer('savings'); };

      document.getElementById('payCardBtn').onclick = openPayCard;

      document.getElementById('cancelTransfer').onclick = closeTransfer;
      document.getElementById('confirmTransfer').onclick = processTransfer;

      document.getElementById('cancelPayment').onclick = closePayCard;
      document.getElementById('confirmPayment').onclick = processPayment;

      // wire forgot password button
      document.getElementById('resetPasswordBtn').onclick = resetPassword;
    };

    function showOnly(pageId) {
      var ids = [
        'loginPage', 'registerPage', 'homePage',
        'applicationPage', 'accountHistoryPage',
        'creditScorePage', 'forgotPage'
      ];

      for (var i = 0; i < ids.length; i++) {
        document.getElementById(ids[i]).style.display = 'none';
      }

      document.getElementById(pageId).style.display = 'block';
    }

    // LOGIN
    function login() {
      var user = document.getElementById('username').value.trim();
      var pass = document.getElementById('password').value;

      if (user.length < 3 || pass.length < 8) {
        document.getElementById('error').style.display = 'block';
        return;
      }

      document.getElementById('error').style.display = 'none';

      var loginDTO = { username: user, password: pass };
      var jsonData = JSON.stringify(loginDTO);
      console.log('Sending Login JSON:', jsonData);

      sendLoginRequest(jsonData);
    }

    function sendLoginRequest(jsonData) {
      var button = document.getElementById('loginButton');
      button.disabled = true;
      button.innerHTML = 'LOGGING IN...';

      var parsedData = JSON.parse(jsonData);
      var username = parsedData.username;
      var password = parsedData.password;

      setTimeout(function () {
        var success = users[username] && users[username] === password;

        var responseObject = {
          success: success,
          message: success ? 'Login successful' : 'Invalid',
          user: success ? { username: username } : null
        };

        console.log('Received Login Response:', JSON.stringify(responseObject));

        if (responseObject.success) {
          localStorage.setItem('loggedIn', 'true');
          localStorage.setItem('username', responseObject.user.username);
          location.reload();
        } else {
          document.getElementById('error').style.display = 'block';
          button.disabled = false;
          button.innerHTML = 'LOGIN';
        }
      }, 800);
    }

    // REGISTER
    function register() {
      var user = document.getElementById('regUsername').value.trim();
      var email = document.getElementById('regEmail').value.trim();
      var pass = document.getElementById('regPassword').value;
      var confirm = document.getElementById('regConfirmPassword').value;
      var ageValue = document.getElementById('regAge').value;
      var age = parseInt(ageValue, 10);

      if (user.length < 3 || pass.length < 8 || pass !== confirm || !age || !email) {
        document.getElementById('regError').innerText = "Check all fields";
        document.getElementById('regError').style.display = 'block';
        return;
      }

      document.getElementById('regError').style.display = 'none';

      var accountType = age < 18 ? "Youth" : "Adult";

      var registerDTO = {
        username: user,
        email: email,
        password: pass,
        age: age,
        accountType: accountType
      };

      console.log("Sending Register JSON:", JSON.stringify(registerDTO));

      setTimeout(function () {
        users[user] = pass;

        userAccounts[user] = {
          checking: 0,
          savings: 0,
          credit: 0,
          hasCredit: false,
          createdDate: new Date().toLocaleDateString(),
          customerId: 'CUS-' + Date.now(),
          creditScore: accountType === "Youth" ? 0 : 650,
          age: age,
          accountType: accountType
        };

        alert("Account created as " + accountType + " account");

        showOnly('loginPage');
        document.getElementById('username').value = user;
      }, 600);
    }

    function logout() {
      localStorage.clear();
      location.reload();
    }

    // CREDIT APPLICATION
    function applyForCredit() {
      showOnly('applicationPage');
    }

    function approveCredit() {
      var creditAppDTO = {
        username: localStorage.getItem('username'),
        applicationType: "credit_card",
        requestedLimit: 5000,
        cardType: "VISA"
      };

      console.log('Sending Credit App JSON:', JSON.stringify(creditAppDTO));

      setTimeout(function () {
        accounts.hasCredit = true;
        accounts.credit = 0;
        accounts.creditScore = 720;

        userAccounts[localStorage.getItem('username')] = accounts;

        showOnly('homePage');
        document.getElementById('creditCard').style.display = 'block';
        document.getElementById('applyCreditBtn').style.display = 'none';
        document.getElementById('viewCreditScoreBtn').style.display = 'block';

        updateBalances();
        alert('Credit card approved!');
      }, 700);
    }

    // HISTORY
    function viewHistory() {
      var historyDTO = {
        username: localStorage.getItem('username')
      };

      console.log('Sending History Request:', JSON.stringify(historyDTO));

      showOnly('accountHistoryPage');

      document.getElementById('historyUsername').innerHTML = localStorage.getItem('username');
      document.getElementById('customerId').innerHTML = accounts.customerId || '';
      document.getElementById('accountType').innerHTML = accounts.accountType || '';
      document.getElementById('accountAge').innerHTML = (accounts.age != null) ? accounts.age : '';
    }

    // CREDIT SCORE
    function viewCreditScore() {
      var scoreDTO = {
        username: localStorage.getItem('username'),
        requestType: 'credit_score'
      };

      console.log('Sending Credit Score Request:', JSON.stringify(scoreDTO));

      showOnly('creditScorePage');
      document.getElementById('creditScoreNumber').innerHTML = accounts.creditScore || 650;
    }

    // TRANSFER MODAL
    function openTransfer(from) {
      document.getElementById('fromAccount').value = from;
      document.getElementById('transferAmount').value = '';
      document.getElementById('transferModal').classList.add('show');
    }

    function closeTransfer() {
      document.getElementById('transferModal').classList.remove('show');
    }

    function processTransfer() {
      var from = document.getElementById('fromAccount').value;
      var to = document.getElementById('toAccount').value;
      var amount = parseFloat(document.getElementById('transferAmount').value);

      if (!amount || amount <= 0 || from === to || accounts[from] < amount) {
        alert('Invalid transfer');
        return;
      }

      // JSON keys to match TransferDTO
      var transferDTO = {
        username: localStorage.getItem('username'),
        fromAccount: from,
        toAccount: to,
        amount: amount
      };

      console.log('Sending Transfer JSON:', JSON.stringify(transferDTO));

      setTimeout(function () {
        accounts[from] -= amount;
        accounts[to] += amount;

        userAccounts[localStorage.getItem('username')] = accounts;

        updateBalances();
        closeTransfer();
        alert('Transfer successful!');
      }, 500);
    }

    // PAY CARD MODAL
    function openPayCard() {
      document.getElementById('paymentAmount').value = '';
      document.getElementById('payCardModal').classList.add('show');
    }

    function closePayCard() {
      document.getElementById('payCardModal').classList.remove('show');
    }

    function processPayment() {
      var from = document.getElementById('payFromAccount').value;
      var amount = parseFloat(document.getElementById('paymentAmount').value);

      if (!amount || amount <= 0 || accounts[from] < amount) {
        alert('Invalid payment');
        return;
      }

      // JSON keys to match PaymentDTO
      var paymentDTO = {
        username: localStorage.getItem('username'),
        paymentFrom: from,
        paymentTo: 'credit',
        amount: amount,
        paymentType: 'credit_card'
      };

      console.log('Sending Payment JSON:', JSON.stringify(paymentDTO));

      setTimeout(function () {
        accounts[from] -= amount;

        // pay down credit balance (credit might be negative if you treat it as debt)
        accounts.credit += amount;

        userAccounts[localStorage.getItem('username')] = accounts;

        updateBalances();
        closePayCard();
        alert('Payment successful!');
      }, 500);
    }

    function updateBalances() {
      document.getElementById('checkingBalance').innerHTML = '$' + (accounts.checking || 0).toFixed(2);
      document.getElementById('savingsBalance').innerHTML = '$' + (accounts.savings || 0).toFixed(2);

      if (accounts.hasCredit) {
        var v = accounts.credit || 0;
        document.getElementById('creditBalance').innerHTML = '-$' + Math.abs(v).toFixed(2);
      }
    }

    // FORGOT PASSWORD
    function resetPassword() {
      var u = document.getElementById('forgotUsername').value.trim();
      var p = document.getElementById('newPassword').value;
      var c = document.getElementById('confirmNewPassword').value;

      var forgotError = document.getElementById('forgotError');

      if (!users[u]) {
        forgotError.innerText = "User not found";
        forgotError.style.display = 'block';
        return;
      }

      if (p !== c || p.length < 8) {
        forgotError.innerText = "Invalid password";
        forgotError.style.display = 'block';
        return;
      }

      forgotError.style.display = 'none';

      var dto = { username: u, newPassword: p };
      console.log("Forgot Password DTO:", JSON.stringify(dto));

      setTimeout(function () {
        users[u] = p;
        alert("Password updated");

        // FIXED: no switchPage() call
        showOnly('loginPage');
        document.getElementById('username').value = u;
      }, 600);
    }
  </script>
</body>
</html>
